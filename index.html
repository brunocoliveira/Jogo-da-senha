<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Jogo da Senha</title>
		<link rel="stylesheet" href="index.css">
	</head>
	<body>
        <h1>A Senha</h1>
        <h2>Descubra qual é a senha misteriosa!</h2>
        <h3>Regras:</h3>
        <ul>
            <li>Você deve escolher uma sequência de 4 números distintos de 0 a 9</li>            
            <li>Ao clicar em validar, o jogo te dará dicas da sua senha informada, as dicas podem ser:
                        <ul><li>Verde: o número está correto e está na posição certa</li>
                            <li>Amarelo: o número está correto mas está na posição errada</li>
                            <li>Vermelho: o número está errado</li>
                        </ul></li>
                <li>Você vence  se conseguir  acertar a senha com 9 chances</li>
            </ul>
        </p>
        
        <div class="senha">
            <div class="campo">
                <input class='dig1' type="text" maxlength="1" min="0" max="9">
            </div>
            <div class="campo">
                <input class='dig2' type="text" maxlength="1" min="0" max="9">
            </div>
            <div class="campo">
                <input class='dig3' type="text" maxlength="1" min="0" max="9">
            </div>
            <div class="campo">
                <input class='dig4' type="text" maxlength="1" min="0" max="9">
            </div>
            <button class="validar">VALIDAR SENHA</button>
        </div>
        
        <div id="t1" class="tentativa">
            <h4>Tentativa 1</h4>
            <div class="campo">
                <input id='t1a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t2a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t3a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t4a' class="digito" type="text" readonly>
            </div>
        </div>
        
        <div id="t2" class="tentativa">
            <h4>Tentativa 2</h4>
            <div class="campo">
                <input id='t1a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t2a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t3a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t4a' class="digito" type="text" readonly>
            </div>
        </div>

        <div id="t3" class="tentativa">
            <h4>Tentativa 3</h4>
            <div class="campo">
                <input id='t1a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t2a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t3a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t4a' class="digito" type="text" readonly>
            </div>
        </div>

        <div id="t4" class="tentativa">
            <h4>Tentativa 4</h4>
            <div class="campo">
                <input id='t1a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t2a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t3a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t4a' class="digito" type="text" readonly>
            </div>
        </div>

        <div id="t5" class="tentativa">
            <h4>Tentativa 5</h4>
            <div class="campo">
                <input id='t1a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t2a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t3a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t4a' class="digito" type="text" readonly>
            </div>
        </div>

        <div id="t6" class="tentativa">
            <h4>Tentativa 6</h4>
            <div class="campo">
                <input id='t1a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t2a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t3a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t4a' class="digito" type="text" readonly>
            </div>
        </div>

        <div id="t7" class="tentativa">
            <h4>Tentativa 7</h4>
            <div class="campo">
                <input id='t1a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t2a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t3a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t4a' class="digito" type="text" readonly>
            </div>
        </div>

        <div id="t8" class="tentativa">
            <h4>Tentativa 8</h4>
            <div class="campo">
                <input id='t1a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t2a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t3a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t4a' class="digito" type="text" readonly>
            </div>
        </div>

        <div id="t9" class="tentativa">
            <h4>Tentativa 9</h4>
            <div class="campo">
                <input id='t1a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t2a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t3a' class="digito" type="text" readonly>
            </div>
            <div class="campo">
                <input id='t4a' class="digito" type="text" readonly>
            </div>
        </div>

        <script>
            let senha = ''
            let tentativa = 1
            let botao = document.querySelector('.validar');
                
            let diginums = document.querySelectorAll(".senha input")
            let num = ['0','1','2','3','4','5','6','7','8','9']
            let verifica = false

            /* PRIMEIRA TENTATIVA
            diginums.forEach ( function (diginum) {

            diginum.addEventListener("keydown", function (event)  {
                console.log(event)

                if (diginum == num) {
                    return event.key

                    }else {
                        diginum.value = null
                    }
                })
            
            })
            */
                
            // SEGUNDA TENTATIVA
            diginums.forEach ( function (diginum) {

                diginum.addEventListener("keydown", function (event)  {
                    console.log(event)
                            
                    if (event.key == 'Tab') {
                        return
                    }

                    if (event.key == 'Shift') {
                        return
                    }

                    event.preventDefault()
                                
                    verifica = num.includes(event.key);

                    if (verifica == true) {
                        this.value = event.key
                                    
                    } else {
                        this.value = null
                    }
                            
                })
            })

            botao.addEventListener("click",validar)

            document.addEventListener('DOMContentLoaded', function () {
                senha = senhaNova();
            })
                
            function pertence (value, senhaArray) {
                resultado = senhaArray.some (function (senhaArray)  {
                return this == senhaArray;
                },value); 
                return resultado
            }

            function validar() {
                let tentAtual = document.getElementById('t'+ tentativa)
                let senhaArray = senha.split('')
                let inputs = document.querySelectorAll(".senha input")
                let senhaCerta = true
                let vazio = false 

                inputs.forEach( function(dig, index) {
                    index=index+1
                        tentAtual.querySelector('#t'+index+'a').value=dig.value

                    if (dig.value == "") {
                        vazio = true
                    }
                })
                    
                if (vazio == true) {
                    window.alert('PREENCHA TODOS OS CAMPOS')
                    return
                }

                let repetido = false

                for (count = 0; repetido == false && count < inputs.length; count++) {

                    for (count2 = count+1; count2 < inputs.length; count2++) {
                        console.count()
                    
                        if (inputs[count].value == inputs[count2].value) {
                            repetido = true
                            break
                        }
                    }
                }
                    
                if (repetido == true) {
                    window.alert('OS NÚMEROS NÃO PODEM SE REPETIR')
                    return
                }

            inputs.forEach( function(dig, index) {
                index=index+1
                    tentAtual.querySelector('#t'+index+'a').value=dig.value

                if (dig.value == senhaArray[index-1]) {
                    tentAtual.querySelector('#t'+index+'a').style.backgroundColor = '#53FD30'
                        
                    } else if (pertence(dig.value, senhaArray)) {
                    tentAtual.querySelector('#t'+index+'a').style.backgroundColor = '#FDDE30'
                    senhaCerta = false
                    
                    } else {
                    tentAtual.querySelector('#t'+index+'a').style.backgroundColor = '#FD3030'
                    senhaCerta = false

                }
            })

            tentAtual.style.display  ='block'
                
            tentativa++
                
            if (senhaCerta == true) {
                window.alert('ACERTÔ MISERAVI!')
                botao.innerText = 'REINICIAR JOGO'

                botao.addEventListener("click",reiniciar)
                botao.removeEventListener("click",validar)
            }

            if (tentAtual.id == 't9') {
                window.alert('ERRROOUUU!!!')
                botao.innerText = 'REINICIAR JOGO'
                    
                botao.addEventListener("click",reiniciar)
                botao.removeEventListener("click",validar)
            }
        }

        function reiniciar () {
            let escondes = document.querySelectorAll('.tentativa');
            let inputs = document.querySelectorAll(".campo input")
                                
            escondes.forEach ( function(esconde) {
                esconde.style.display = 'none'

            })

            inputs.forEach ( function(input) {
                input.value = null

            })
                    
            tentativa = 1;

            botao.addEventListener("click",validar)
            botao.removeEventListener("click",reiniciar)
            botao.innerText = 'VALIDAR SENHA'

            senha = senhaNova();

        }

        function senhaNova() {
                
            let nova = '';
            let numNovo = '';
            let compar = '';
                                                            
            do{
                numNovo = Math.random().toString(10).substr(2, 1);
                    
                compar = nova.includes(numNovo);
                        
                if (compar == false) {
                    nova += numNovo                    // adiciona este numero a string
                }

            }   while(nova.length < 4)
                    
            nova = nova.substr(0, 4)        //a função substr (nesse caso) vai pegar 4 termos da string, começando pelo termo 0
                    
            return nova
        }
                                
    </script>
    </body>
</html>